<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>CEU VAULT</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="formStyle.css" rel="stylesheet" type="text/css">
  <link href="styles.css" rel="stylesheet" type="text/css">
</head>

<body class="body">

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const emailInput = document.getElementById('email');
      const errorMessage = document.getElementById('error-message');
      const pattern = /^[a-zA-Z0-9._%+-]+@(mls\.ceu\.edu\.ph|ceu\.edu\.ph)$/;

      function validateEmail() {
        if (!pattern.test(emailInput.value)) {
          errorMessage.style.display = 'block';
        } else {
          errorMessage.style.display = 'none';
        }
      }

      emailInput.addEventListener('input', validateEmail);
      emailInput.addEventListener('blur', validateEmail);
    });
  </script>

  <div class="navbar-no-shadow">
    <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease"
      role="banner" class="navbar-no-shadow-container w-nav">
      <div class="container-regular">
        <div class="navbar-wrapper">
          <div class="w-layout-hflex ceuvaultbrandflex">
            <a href="#" class="ceulogo w-nav-brand"><img width="85" loading="lazy" alt="" src="../images/CEU-Logo.png"
                class="image"></a>
            <div class="w-layout-hflex ceuvaultbrandtext">
              <h4 class="heading">Centro Escolar University</h4>
              <h1 class="heading-2">CEU <span class="text-span">VAULT</span></h1>
              <h5 class="heading-3">MALOLOS TLTS FACILITY</h5>
            </div>
          </div>
          <nav role="navigation" class="nav-menu-wrapper w-nav-menu">
            <ul role="list" class="nav-menu w-list-unstyled">
              <li class="list-item-2">
                <a href="../home-page" class="button-primary w-button">home</a>
              </li>
              <li class="list-item">
                <a href="#" class="button-primary w-button">Borrow</a>
              </li>
              <li class="list-item-3">
                <a href="../Inventory" class="button-primary w-button">inventory</a>
              </li>
            </ul>
          </nav>
          <div class="menu-button w-nav-button">
            <div class="icon w-icon-nav-menu"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <section class="section-3">
    <div class="div-block-6 fade-section">
      <h1 class="heading-4">REQUISITIONER FORM</h1>
    </div>

    <div id="reqFormGrid" class="w-layout-layout quick-stack wf-layout-layout fade-section">
      <div id="reqFormGrid" class="w-layout-cell cell">
        <h1 class="heading-7">GUIDELINE ONE</h1>
      </div>
      <div class="w-layout-cell cell-2">
        <p class="paragraph">The borrower should accomplish the Application of TLTD/TLT Section Equipment, Materials,
          Services Form. He/she shall be immediately informed by the staff member if and when his/her request is not
          approved of by the Head/Coordinator either due to conflict in the schedule or the requested equipment is
          unavailable on the specified date requested for use.</p>
      </div>
    </div>
  </section>

  <section class="containerDaniel">
    <div class="container ">
      <header class="header" style="color: white;">
        <h1 id="title" class="text-center">Application for TLTD/TLT Section Equipment, Materials, Services Form</h1>

      </header>

      <form id="main-form" style="color: white;">
        <div class="form-group ">
          <label id="first-name-label" for="first-name">First Name</label>
          <input type="text" name="first-name" id="first-name" class="form-control" placeholder="Enter your first name"
            required="">
        </div>

        <div class="form-group">
          <label id="last-name-label" for="last-name">Last Name</label>
          <input type="text" name="last-name" id="last-name" class="form-control" placeholder="Enter your last name"
            required="">
        </div>

        <div class="form-group">
          <label id="department-label" for="department-name">Department Name</label>
          <input type="text" name="department-name" id="department-name" class="form-control"
            placeholder="School / College / Department / Office." required="">
        </div>

        <div class="form-group">
          <label id="email-label" for="email">Email</label>
          <input type="email" name="email" id="email" class="form-control" placeholder="Enter your email"
            pattern="^[a-zA-Z0-9._%+\-]+@(mls\.ceu\.edu\.ph|ceu\.edu\.ph)$" required">
        </div>
        <div id="error-message" class="neon-glow" style="display: none; margin: auto; margin: -16px auto 16px 8px">
          Invalid email domain. Please use an email ending with
          @mls.ceu.edu.ph or @ceu.edu.ph.</div>

        <div class="form-group">
          <p>Nature of Service/s Requested:</p>
          <select id="dropdown" name="natureOfService" class="form-control" required="">
            <option disabled="" selected="" value="">None</option>
            <option value="Academic">Academic</option>
            <option value="Co-Curricular">Co-Curricular / Extra-curricular</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div id="additional-field-container"></div> <!-- Container for the additional text field -->

        <div class="form-group">
          <p>Purpose:</p>
          <select id="purposeDropdown" name="purpose" class="form-control" required="">
            <option disabled="" selected="" value="">None</option>
            <option value="Presentation">Presentation/Lecture</option>
            <option value="Viewing">Viewing</option>
            <option value="otherPurpose">Other Purposes</option>
          </select>
        </div>

        <div id="purpose-field-container"></div> <!-- Container for the additional text field -->

        <div class="form-group">
          <label id="venue-label" for="venue">Room/Venue</label>
          <input type="text" name="venue" id="venue" class="form-control"
            placeholder="Where would you use the equipment?" required style="margin-bottom: 30px;">
        </div>

        <hr>

        <div id="inputs-container" class="row g-1 form-group" style="margin-top: 35px;">

          <label class="form-label" for="equipment-select">Choose equipment:</label>
          <select class="form-control" id="equipment-select" name="equipment-select" style="margin-bottom: 10px;"
            required>
            <option value="" selected>Select an option</option>
            <option value="DLP-LCD Projector">DLP-LCD Projector</option>
            <option value="Laptop">Laptop</option>
            <option value="Overhead Projector">Overhead Projector</option>
            <option value="VHS Player">VHS Player</option>
            <option value="Sound System">Sound System</option>
            <option value="DVD Player">DVD Player</option>
            <option value="VCD Player">VCD Player</option>
            <option value="CD Cassette Player">CD Cassette Player</option>
            <option value="Karaoke">Karaoke</option>
            <option value="Microphone">Microphone</option>
            <option value="Document Camera">Document Camera</option>
            <option value="Digital Video Camera">Digital Video Camera</option>
            <option value="Digital Still Camera">Digital Still Camera</option>
            <option value="Audio Voltage Regulator">Audio Voltage Regulator</option>
            <option value="Amplifier">Amplifier</option>
            <option value="Audio Mixer">Audio Mixer</option>
            <option value="Stereo Graphic Equalizer">Stereo Graphic Equalizer</option>
            <option value="Globe Map">Globe Map</option>
            <option value="Television Set">Television Set</option>
            <option value="Tripod">Tripod</option>
            <option value="Microphone Stand">Microphone Stand</option>
            <option value="Wireless Microphone">Wireless Microphone</option>
            <option value="Lapel Microphone">Lapel Microphone</option>
            <option value="Radio Cassette">Radio Cassette</option>
            <option value="Projector Screen">Projector Screen</option>
            <option value="External Hard Drive">External Hard Drive</option>
          </select>

          <div class="col-md-4" id="startDate">
            <label class="form-label" for="startDateTime">Start Date and Time:</label>
            <input type="datetime-local" id="startDateTime" name="startDateTime" class="form-control"
              style="color: #000; margin: 0 0 10px 0;" required>

          </div>
          <div class="col-md-4" id="endTime">
            <label class="form-label" for="endTime">Return Time: </label>
            <input type="time" id="endTime" name="endTime" class="form-control" style="color: #000; margin: 0 0 10px 0;"
              required>

          </div>
          <div class="col-md-3" id="quantity">
            <label class="form-label" for="quantity">Quantity: </label>
            <input type="number" id="quantity" name="quantity" class="form-control"
              style="color: #000; margin: 0 0 10px 0;" min="1" placeholder="How many?" required>
          </div>


        </div>
        <button id="add-more" class="form-control" type="button"
          style="background-color: rgb(13,110,253); color: white; margin-bottom: 50px; border-radius: 10px;">Request
          more equipment</button>


        <div id="form-duplicates"></div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="terms-checkbox" class="input-checkbox"> I agree to
            the Terms and Conditions
          </label>
        </div>

        <div id="terms-popup" class="popup-container">
          <div class="popup-content" style="color: #000;">
            <h2>Terms and Conditions</h2>
            <p>
              By using this form, you agree to the following terms and conditions:
            </p>
            <p>
              I acknowledge receipt of and responsibility for item/s listed above which I promise to return on the
              specified date and time.
            </p>
            <p>
              I agree to the imposed fine per hour for each material/equipment not returned on due time.
            </p>
            <p>
              I also understand that I am accountable for any loss and/or damage of the item/s I borrowed. I promise to
              abide by all these policies and certify that personal data stated herein are correct.
            </p>
            <button id="agree-button" class="popup-button" type="button">Agree</button>
            <button id="close-button" class="popup-button" type="button">Close</button>
          </div>
        </div>

        <div class="form-group">
          <button type="submit" id="submit" class="submit-button">
            Submit
          </button>
        </div>

      </form>

    </div>
  </section>

  <section class="section-4">
    <p class="paragraph-2">‍<strong class="bold-text-4">CEU Vault Malolos<br>‍</strong>© 2024 Copyright <a
        href="https://www.ceu.edu.ph/" class="link"><strong class="bold-text-2">Centro Escolar University
        </strong></a><strong class="bold-text-3">, Teaching, Learning, and Technology Section <br></strong>Km. 44,
      Macarthur Highway, City of Malolos (Capital), Bulacan, City of Malolos (Capital), Bulacan<br></p>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66e266eb815840690d1652d0"
    type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>
  <script src="../scripts/script.js" type="text/javascript"></script>
  <script src="formFunctions.js" type="text/javascript"></script>
</body>

</html>


<script>
  document.getElementById('add-more').addEventListener('click', function () {
    const container = document.getElementById('inputs-container');
    const clone = container.cloneNode(true);
    const divider = document.createElement('hr');
    const removeButton = document.createElement('button');
    removeButton.textContent = 'Remove';
    removeButton.type = 'button';
    removeButton.classList.add('form-control');
    removeButton.style.backgroundColor = 'red',
      removeButton.style.borderRadius = '10px';
    removeButton.style.color = 'white';
    removeButton.addEventListener('click', function () {
      divider.remove();
      clone.remove();
    });
    clone.appendChild(removeButton);
    document.getElementById('form-duplicates').appendChild(divider);
    document.getElementById('form-duplicates').appendChild(clone);
  });
</script>

<script>
  function handleSubmit(event) {
    event.preventDefault(); // Prevent form submission

    // Check if terms checkbox is checked
    const termsCheckbox = document.getElementById('terms-checkbox');
    if (!termsCheckbox.checked) {
      alert('You must agree to the terms and conditions before submitting the form.');
      return;
    }

    // Gather static form data
    const formData = new FormData(document.getElementById('main-form'));

    const jsonData = {
      firstName: formData.get('first-name'),
      lastName: formData.get('last-name'),
      departmentName: formData.get('department-name'),
      email: formData.get('email'),
      natureOfService: formData.get('natureOfService'),
      purpose: formData.get('purpose'),
      venue: formData.get('venue'),
      equipmentCategories: []
    };

    // Function to format time to hh:mm:ss
    function formatTimeToHHMMSS(timeString) {
      const [hours, minutes] = timeString.split(':');
      return `${hours}:${minutes}:00`;
    }

    // Collect all dynamic forms including the original one
    const formContainers = document.querySelectorAll('#inputs-container, #form-duplicates > .row');

    formContainers.forEach(container => {
      const dropdown = container.querySelector('select[name="equipment-select"]');
      const startDateTime = container.querySelector('input[name="startDateTime"]');
      const endTime = container.querySelector('input[name="endTime"]');
      const quantity = container.querySelector('input[name="quantity"]');

      // Add the selected equipment and details to jsonData
      if (dropdown && dropdown.value) {
        jsonData.equipmentCategories.push({
          category: dropdown.value,
          quantity: parseInt(quantity.value, 10),
          dateRequested: startDateTime.value.split('T')[0],
          timeRequested: startDateTime.value.split('T')[1] || '',
          returnTime: formatTimeToHHMMSS(endTime.value)
        });
      }
    });

    // Convert JSON object to string for submission
    const jsonString = JSON.stringify(jsonData, null, 2);
    console.log(jsonString); // Debug the JSON data

    // POST request to the API endpoint
    fetch('/equipments/insert-details', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: jsonString,
      credentials: 'include'
    })
      .then(response => response.json())
      .then(data => {
        if (data.successful) {
          alert('Form submitted successfully!');
          document.getElementById('main-form').reset(); // Reset form after successful submission
          document.getElementById('form-duplicates').innerHTML = ''; // Reset dynamic inputs
          window.location.href = '../otp/index.html'; // Redirect to ../otp/index.html
        } else {
          alert(`Error: ${data.message}`);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while submitting the form.');
      });
  }
  // Function to reset dynamic inputs to their original hidden state
  function resetDynamicInputs() {
    const dynamicInputs = document.querySelectorAll('[id$="-startDate"], [id$="-endTime"], [id$="-quantity"]');
    dynamicInputs.forEach(input => {
      input.style.display = 'none';
    });
  }

  // Ensure the handleSubmit function is only attached once
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('main-form');
    if (form) {
      console.log('Attaching form submit handler'); // Debugging log
      form.removeEventListener('submit', handleSubmit); // Remove any existing listener
      form.addEventListener('submit', handleSubmit); // Attach the new listener
    }
  });
</script>