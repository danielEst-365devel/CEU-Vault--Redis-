<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/CEU-Logo.png">
  <link rel="icon" type="image/png" href="../assets/img/CEU-Logo.png">
  <title>
    CEU VAULT | Sign In
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/soft-ui-dashboard.css" rel="stylesheet" />
  <!-- Nepcha Analytics (nepcha.com) -->
  <!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->
  <script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
</head>

<style>
  /* Add this to your CSS */
  .loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }

  /* Add these styles if not already included by Bootstrap */
  .toast-container {
    z-index: 9999;
  }

  .toast {
    min-width: 250px;
  }
</style>

<body class="">
  <div class="container position-sticky z-index-sticky top-0">
    <div class="row">
      <div class="col-12">
        <!-- Navbar -->
        <nav
          class="navbar navbar-expand-lg blur blur-rounded top-0 z-index-3 shadow position-absolute my-3 py-2 start-0 end-0 mx-4">
          <div class="container-fluid pe-0">
            <a class="navbar-brand font-weight-bolder ms-lg-0 ms-3 " href="/admin/home-page/">
              CEU VAULT Administrator
            </a>
            <button class="navbar-toggler shadow-none ms-2" type="button" data-bs-toggle="collapse"
              data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false"
              aria-label="Toggle navigation">
              <span class="navbar-toggler-icon mt-2">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
              </span>
            </button>
            <div class="collapse navbar-collapse" id="navigation">
              <ul class="navbar-nav mx-auto ms-xl-auto me-xl-7">
                <li class="nav-item">
                  <a class="nav-link d-flex align-items-center me-2 active" aria-current="page" href="../home-page/">
                    <i class="fa fa-chart-pie opacity-6 text-dark me-1"></i>
                    Dashboard
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link me-2" href="../profile/">
                    <i class="fa fa-user opacity-6 text-dark me-1"></i>
                    Profile
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link me-2" href="../sign-up/">
                    <i class="fas fa-user-circle opacity-6 text-dark me-1"></i>
                    Sign Up
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link me-2" href="../sign-in">
                    <i class="fas fa-key opacity-6 text-dark me-1"></i>
                    Sign In
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
        <!-- End Navbar -->
      </div>
    </div>
  </div>
  <main class="main-content  mt-0">
    <section>
      <div class="page-header min-vh-75">
        <div class="container">
          <div class="row">
            <div class="col-xl-4 col-lg-5 col-md-6 d-flex flex-column mx-auto">
              <div class="card card-plain mt-8">
                <div class="card-header pb-0 text-left bg-transparent">
                  <h3 class="font-weight-bolder text-info text-gradient">Welcome back</h3>
                  <p class="mb-0">Enter your email and password to sign in</p>
                </div>
                <div class="card-body">
                  <form id="loginForm" role="form">
                    <label>Email</label>
                    <div class="mb-3">
                      <input type="email" name="email" class="form-control" placeholder="Email" required>
                    </div>
                    <label>Password</label>
                    <div class="mb-3">
                      <input type="password" name="password" class="form-control" placeholder="Password" required>
                    </div>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="rememberMe" checked="">
                      <label class="form-check-label" for="rememberMe">Remember me</label>
                    </div>
                    <div class="text-center">
                      <button type="submit" id="submitButton" class="btn bg-gradient-info w-100 mt-4 mb-0">
                        Sign in
                      </button>
                    </div>
                  </form>
                  <!-- Add this right after your form -->
                  <div id="loadingOverlay" class="loading-overlay">
                    <div class="spinner"></div>
                  </div>

                </div>
                <div class="card-footer text-center pt-0 px-lg-2 px-1">
                  <p class="mb-4 text-sm mx-auto">
                    Don't have an account?
                    <a href="../sign-up/" class="text-info text-gradient font-weight-bold">Sign up</a>
                  </p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="oblique position-absolute top-0 h-100 d-md-block d-none me-n8">
                <div class="oblique-image bg-cover position-absolute fixed-top ms-auto h-100 z-index-0 ms-n6"
                  style="background-image:url('../assets/img/navbar-bg.jpg')"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  <!-- -------- START FOOTER 3 w/ COMPANY DESCRIPTION WITH LINKS & SOCIAL ICONS & COPYRIGHT ------- -->
  <footer class="footer py-5">
    <div class="container">
      <div class="row">
        <div class="col-8 mx-auto text-center mt-1">
          <p class="mb-0 text-secondary">
            Copyright Â©
            <script>
              document.write(new Date().getFullYear())
            </script> <strong>CEU VAULT</strong> for TLTS, CEU Malolos. All rights reserved.
          </p>
        </div>
      </div>
    </div>
  </footer>
>
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/soft-ui-dashboard.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Check for existing token first
      const checkAuth = async () => {
        try {
          const response = await fetch('/admin/verify-login', {
            method: 'GET',
            credentials: 'include' // Important for cookies
          });

          if (response.ok) {
            window.location.href = '/admin/home-page/';
            return true;
          }
          return false;
        } catch (error) {
          console.error('Auth check failed:', error);
          return false;
        }
      };

      // Run auth check immediately
      checkAuth().then(isAuthenticated => {
        if (!isAuthenticated) {
          // Existing login form logic - only initialize if not authenticated
          const loginForm = document.getElementById('loginForm');
          const submitButton = document.getElementById('submitButton');
          const loadingOverlay = document.getElementById('loadingOverlay');
          const rememberMeCheckbox = document.getElementById('rememberMe');

          // Check for remembered email
          const rememberedEmail = localStorage.getItem('rememberedEmail');
          if (rememberedEmail) {
            const emailInput = loginForm.querySelector('input[name="email"]');
            emailInput.value = rememberedEmail;
            rememberMeCheckbox.checked = true;
          }

          loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loadingOverlay.style.display = 'flex';
            submitButton.disabled = true;

            const formData = new FormData(loginForm);
            const credentials = {
              email: formData.get('email'),
              password: formData.get('password'),
              rememberMe: rememberMeCheckbox.checked
            };

            try {
              const response = await fetch('/admin/login', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(credentials),
                credentials: 'include'
              });

              const data = await response.json();

              if (response.ok) {
                if (rememberMeCheckbox.checked) {
                  localStorage.setItem('rememberedEmail', credentials.email);
                } else {
                  localStorage.removeItem('rememberedEmail');
                }
                window.location.href = '/admin/home-page/';
              } else {
                showToast(data.message || 'Login failed', 'danger');
              }
            } catch (error) {
              console.error('Login error:', error);
              showToast('Network error occurred', 'danger');
            } finally {
              loadingOverlay.style.display = 'none';
              submitButton.disabled = false;
              submitButton.innerHTML = 'Sign in';
            }
          });
        }
      });
    });

    // Replace your existing showToast function with this:
    function showToast(message, type = 'danger') {
      const toastContainer = document.getElementById('toast-container');

      const toastEl = document.createElement('div');
      toastEl.className = `toast align-items-center border-0 mb-2`;
      toastEl.setAttribute('role', 'alert');
      toastEl.setAttribute('aria-live', 'assertive');
      toastEl.setAttribute('aria-atomic', 'true');

      toastEl.innerHTML = `
        <div class="toast-header">
            <img src="../assets/img/CEU-Logo.png" alt="Icon" width="30" height="30" class="me-2">
            <strong class="me-auto">CEU Vault Administrator</strong>
            <small>Just now</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body ${type === 'danger' ? 'text-white bg-danger' : ''}">
            ${message}
        </div>
    `;

      toastContainer.appendChild(toastEl);
      const toast = new bootstrap.Toast(toastEl);
      toast.show();

      toastEl.addEventListener('hidden.bs.toast', () => {
        toastEl.remove();
      });
    }
  </script>

  <!-- Add this before closing body tag -->
  <div aria-live="polite" aria-atomic="true" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
    <div id="toast-container"></div>
  </div>
</body>


</html>